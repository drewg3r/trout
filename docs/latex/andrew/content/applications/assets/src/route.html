{% extends 'base.html' %}
{% load time_render %}
{% load stops_amount_render %}

{% block content %}

<h1>Маршрут:</h1>
<h2>
  {{ route.origin }} — {{ route.destination }}
</h2>

<div>
  Час прибуття до {{ route.destination }}: <span>{% render_time route.destination_arrival_time %}</span> (в дорозі {% render_timedelta route.travel_time %})
</div>

<div class="d-flex flex-column flex-md-row p-4 gap-4 py-md-5 align-items-center justify-content-center">
  <div class="list-group">

    {% for line in route.direct_lines %}
      <a href="#" class="list-group-item list-group-item-action d-flex gap-3 py-3" aria-current="true" data-bs-toggle="modal" data-bs-target="#stationDetailsModal{{ line.first_waypoint.station.id }}">
        <div class="align-self-center">
          <i class="fa fa-map-marker-alt fs-4"></i>
        </div>
        <div class="d-flex gap-2 w-100 justify-content-between">
          <div>
            <h6 class="mb-0">{{ line.first_waypoint.station }}</h6>
            <p class="mb-0 opacity-75">
              <span class="fw-bold">{{ line.name }}</span>
              <i class="fa fa-arrow-right"></i>
              <span>{{ line.end_station }}</span>
            </p>
          </div>
          <small class="opacity-50 text-nowrap">{% render_time line.first_waypoint.departure_time %}</small>
        </div>
      </a>
      {% include "main/client/modals/station_details.html" with waypoint=line.first_waypoint modal_id=line.first_waypoint.station.id %}

      {% if line.intermediate_waypoints %}
        <a href="#" class="list-group-item list-group-item-action d-flex gap-3 py-3 ps-5" aria-current="true" data-bs-toggle="modal" data-bs-target="#stationDetailsModal{{ line.first_waypoint.station.id|add:10000 }}">
          <div class="align-self-center">
            <i class="fa fa-ellipsis-v fs-4"></i>
          </div>
          <div class="d-flex gap-2 w-100 justify-content-between">
            <div class="align-self-center">
              <h6 class="mb-0">Проїдьте {%  render_stops line.intermediate_waypoints|length %}</h6>
            </div>
            <div class="align-self-center">
              <small class="opacity-50 text-nowrap">прибл. {% render_timedelta line.travel_time %}</small>
            </div>
          </div>
        </a>
        {% include "main/client/modals/multiple_station_details.html" with line=line modal_id=line.first_waypoint.station.id|add:10000 %}
      {% endif %}
    {% endfor %}

    <a href="#" class="list-group-item list-group-item-action d-flex gap-3 py-3" aria-current="true" data-bs-toggle="modal" data-bs-target="#stationDetailsModal{{ route.destination_waypoint.station.id }}">
      <div class="align-self-center">
        <i class="fa fa-map-marker-alt fs-4"></i>
      </div>
      <div class="d-flex gap-2 w-100 justify-content-between">
        <div class="align-self-center">
          <h6 class="mb-0">{{ route.destination }}</h6>
        </div>
        <div class="align-self-center">
          <small class="opacity-50 text-nowrap">{% render_time route.destination_arrival_time %}</small>
        </div>
      </div>
    </a>
    {% include "main/client/modals/station_details.html" with waypoint=route.destination_waypoint modal_id=route.destination_waypoint.station.id %}

  </div>
</div>

{% endblock %}
